<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Tutorial: Overlays for interventions in epidemic modelling • overshiny</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Tutorial: Overlays for interventions in epidemic modelling">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">overshiny</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/overshiny.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/epidemics.html">Tutorial: Overlays for interventions in epidemic modelling</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/nicholasdavies/overshiny/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Tutorial: Overlays for interventions in epidemic modelling</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nicholasdavies/overshiny/blob/master/vignettes/epidemics.Rmd" class="external-link"><code>vignettes/epidemics.Rmd</code></a></small>
      <div class="d-none name"><code>epidemics.Rmd</code></div>
    </div>

    
    
<p>This tutorial will walk you through how to use <code>overshiny</code>
to add interactive overlays to epidemic curves generated by an
infectious disease transmission model to explore the effect of different
interventions like vaccines and social distancing. This is the use case
that originally spurred the development of <code>overshiny</code> as an
offshoot of an infectious disease modelling Shiny app developed at the
London School of Hygiene and Tropical Medicine during the COVID-19
pandemic.</p>
<p>This tutorial doesn’t assume any previous knowledge of
<code>shiny</code> or <code>overshiny</code>, but is not a comprehensive
introduction to <code>shiny</code>. We will be using the package
<code>epidemics</code> to provide the actual infectious disease model
underlying the simulation.</p>
<div class="section level2">
<h2 id="epidemic-simulation">Epidemic simulation<a class="anchor" aria-label="anchor" href="#epidemic-simulation"></a>
</h2>
<p>OK, let’s begin. If you’re developing a <code>shiny</code> app based
around some relatively complex simulation code, it often helps to start
by putting the simulation code together outside the context of a
<code>shiny</code> app, and later building the app to include it. That
helps you catch errors with the simulation code before putting it into
an app, which often makes it harder to catch errors. So let’s start with
our infectious disease model in <code>epidemics</code> and move on to
the <code>shiny</code> app later on.</p>
<p>First, make sure you have the <code>epidemics</code> package
installed:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"epiverse-trace/epidemics"</span><span class="op">)</span></span></code></pre></div>
<p>Now, let’s build a simple function that will produce a simulation run
from <code>epidemics</code> and return the results.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">epidemics</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Model run function</span></span>
<span><span class="va">run_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>    <span class="co"># Build parameters</span></span>
<span>    <span class="va">I0</span> <span class="op">&lt;-</span> <span class="fl">0.001</span></span>
<span>    <span class="va">pop_size</span> <span class="op">&lt;-</span> <span class="fl">1000000</span></span>
<span>    </span>
<span>    <span class="co"># Build population</span></span>
<span>    <span class="va">pop</span> <span class="op">&lt;-</span> <span class="fu">population</span><span class="op">(</span></span>
<span>        name <span class="op">=</span> <span class="st">"Utopia"</span>,</span>
<span>        contact_matrix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        demography_vector <span class="op">=</span> <span class="fl">1000000</span>,</span>
<span>        initial_conditions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">I0</span>, <span class="fl">0</span>, <span class="va">I0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Run model</span></span>
<span>    <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">model_default</span><span class="op">(</span><span class="va">pop</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span> <span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Note that <code>I0</code> is the initial proportion of infectious
individuals, and <code>pop_size</code> is the total population size.
Test this function out and see if you can plot the prevalence of
infection (compartment <code>"infectious"</code>) before continuing.</p>
<details><summary>
Click for one possible answer
</summary><p>Here’s how you might do it using <code>ggplot2</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">run_model</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">[</span><span class="va">results</span><span class="op">$</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"infectious"</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="st">"Infection prevalence"</span><span class="op">)</span></span></code></pre></div>
</details><div class="section level3">
<h3 id="connecting-to-a-mock-up-of-input">Connecting to a mock-up of <code>input</code><a class="anchor" aria-label="anchor" href="#connecting-to-a-mock-up-of-input"></a>
</h3>
<p>At the moment, our <code>run_model()</code> function produces an
epidemic curve based on some default parameters. We want
<code>run_model()</code> to respond to user input, though, so that users
of our app can provide parameters like the basic reproduction number
<i>R</i><sub>0</sub>, the infectious period, the duration of the
epidemic, and so on.</p>
<p>Within <code>shiny</code>, user input is provided in a list called
<code>input</code>. So let’s say that the <code>input</code> list
contained the following:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>input <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>    <span class="co"># Start and end dates of the epidemic</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>    <span class="at">date_range =</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">"2025-01-01"</span>, <span class="st">"2025-12-31"</span>)),</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>    <span class="co"># Population size in millions</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>    <span class="at">pop_size =</span> <span class="dv">59</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>    <span class="co"># Percentage (not proportion) of the population initially infected</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>    <span class="at">init_infec =</span> <span class="fl">0.1</span>,</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>    <span class="co"># Duration of latent period in days</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>    <span class="at">latent_pd =</span> <span class="dv">2</span>,</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>    <span class="co"># Duration of infectious period in days</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>    <span class="at">infec_pd =</span> <span class="dv">7</span>,</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>    <span class="co"># Basic reproduction number</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>    <span class="at">R0 =</span> <span class="fl">1.3</span>,</span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>)</span></code></pre></div>
<p>Note that in the above, we have specified lots of the parameters in
“natural” units – the population size is in millions, the initial
proportion of infected people is in percent (not a proportion), and we
specify an infectious period in days rather than a recovery rate in
days<sup>-1</sup>. Also, rather than specifying a total duration for the
epidemic in days, we have specified a start date and end date for the
epidemic. This is because we’re going to develop our Shiny app with end
users in mind, and they may not be used to the more mathematically
tractable units that infectious disease modellers use.</p>
<p>By looking at the documentation for
<code>epidemics::population()</code> and
<code>epidemics::model_default()</code>, can you rewrite the
<code>run_model()</code> function so that it sets all the relevant
parameters according to the <code>input</code> list above?</p>
<details><summary>
Click for one possible answer
</summary><p>Here’s how you might do it:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Model run function</span></span>
<span><span class="va">run_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>    <span class="co"># Transform parameters</span></span>
<span>    <span class="va">I0</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">init_infec</span> <span class="op">/</span> <span class="fl">100</span>; <span class="co"># Percent to proportion</span></span>
<span>    <span class="va">duration</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">date_range</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">input</span><span class="op">$</span><span class="va">date_range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="co"># Dates to duration</span></span>
<span>    <span class="va">infec_rate</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">input</span><span class="op">$</span><span class="va">latent_pd</span> <span class="co"># Latent period to infectiousness rate</span></span>
<span>    <span class="va">recov_rate</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">input</span><span class="op">$</span><span class="va">infec_pd</span>  <span class="co"># Infectious period to recovery rate</span></span>
<span>    <span class="va">trans_rate</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">R0</span> <span class="op">*</span> <span class="va">recov_rate</span> <span class="co"># R0 to transmission rate (R_0 = beta / gamma)</span></span>
<span></span>
<span>    <span class="co"># Build population</span></span>
<span>    <span class="va">pop</span> <span class="op">&lt;-</span> <span class="fu">population</span><span class="op">(</span></span>
<span>        name <span class="op">=</span> <span class="st">"Utopia"</span>,</span>
<span>        contact_matrix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        demography_vector <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">pop_size</span> <span class="op">*</span> <span class="fl">1000000</span>, <span class="co"># Population size in millions</span></span>
<span>        initial_conditions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">I0</span>, <span class="fl">0</span>, <span class="va">I0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Run model</span></span>
<span>    <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">model_default</span><span class="op">(</span><span class="va">pop</span>, transmission_rate <span class="op">=</span> <span class="va">trans_rate</span>,</span>
<span>        infectiousness_rate <span class="op">=</span> <span class="va">infec_rate</span>, recovery_rate <span class="op">=</span> <span class="va">recov_rate</span>,</span>
<span>        time_end <span class="op">=</span> <span class="va">duration</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span> <span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</details><p>Once you’ve done this, check that you’re happy with the results
before moving on.</p>
</div>
</div>
<div class="section level2">
<h2 id="shiny-app-skeleton">Shiny app skeleton<a class="anchor" aria-label="anchor" href="#shiny-app-skeleton"></a>
</h2>
<p>Now, let’s set our simulation code aside and put together a basic
<code>shiny</code> app.</p>
<p>All <code>shiny</code> apps have two parts. The first part is a
<code>ui</code> or User Interface, which determines how the app is laid
out. This is where you define all the components of the app, where they
are, and what they look like. The second part is a <code>server</code>
function, which is where the processing happens. The server is where you
transform all the user inputs into outputs, and do any calculations that
need to respond to user input.</p>
<p>Let’s start with a really basic skeleton for our <code>shiny</code>
app. This can go in a new <code>.R</code> script file, but don’t get rid
of your old code from the last section as we’ll put it back in
later.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">epidemics</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.posit.co/" class="external-link">shiny</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># --- User interface ---</span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidPage</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/titlePanel.html" class="external-link">titlePanel</a></span><span class="op">(</span><span class="st">"SEIRV model with interventions"</span><span class="op">)</span>,</span>
<span></span>
<span>    <span class="co"># 3 columns of inputs</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidRow</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html" class="external-link">column</a></span><span class="op">(</span><span class="fl">4</span>,</span>
<span>            <span class="co"># Basic epidemic settings</span></span>
<span>            <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">h3</a></span><span class="op">(</span><span class="st">"Epidemic"</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html" class="external-link">column</a></span><span class="op">(</span><span class="fl">4</span>,</span>
<span>            <span class="co"># Pathogen settings</span></span>
<span>            <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">h3</a></span><span class="op">(</span><span class="st">"Pathogen"</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html" class="external-link">column</a></span><span class="op">(</span><span class="fl">4</span>,</span>
<span>            <span class="co"># Intervention settings</span></span>
<span>            <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">h3</a></span><span class="op">(</span><span class="st">"Interventions"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># --- App logic ---</span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># --- Run app ---</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></span></code></pre></div>
<p>Put all that in a script and run it. You should see a window pop up
with a big title that says “SEIRV model with interventions”, and three
smaller titles underneath.</p>
<p>Even though this is a very basic app, there’s a lot to unpick here.
In particular, the large part of the script that generates the user
interface has a lot going on. Let’s take it step by step.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># --- User interface ---</span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidPage</a></span><span class="op">(</span></span>
<span>    <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>In <code>shiny</code>, the user interface is constructed of nested
function calls. This mirrors the nested structure of a web page – so
e.g. here the <code>fluidPage</code> contains several elements, which
themselves may contain several other elements. <code>fluidPage</code> is
just one option for the top-level element; others include
<code>fixedPage</code> or <code>basicPage</code>. <code>fluidPage</code>
is a flexible layout that can dynamically rearrange the elements if your
user is using a smaller screen like on a mobile phone, so it’s handy to
use.</p>
<p>To make use of this dynamic rearrangement, a <code>fluidPage</code>
is divided into rows, defined using the function <code>fluidRow</code>,
and each <code>fluidRow</code> is divided into columns, where all of the
columns in a row together have a width that adds up to 12. They chose 12
because it divides well into 1, 2, 3, 4, or 6 sections. On a computer,
normally you will see the <code>fluidRow</code> all in one actual row,
but if you are looking at your Shiny app on a smaller screen, you might
see your <code>fluidRow</code> broken up across multiple actual rows. As
an example, if your <code>shiny</code> ui contains:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidRow</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html" class="external-link">column</a></span><span class="op">(</span><span class="fl">4</span>, <span class="st">"part one"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html" class="external-link">column</a></span><span class="op">(</span><span class="fl">4</span>, <span class="st">"part two"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html" class="external-link">column</a></span><span class="op">(</span><span class="fl">4</span>, <span class="st">"part three"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
then on a larger screen, you would see something like
<pre>part one     part two    part three  </pre>
while on a phone, you might see
<pre>part one
part two
part three</pre>
<p>Arranging each part vertically on a small screen instead of
horizontally helps ensure that your content don’t get too hard to see on
a mobile device because it’s all squished into one row, which is
especially helpful if the columns contain plots or other more complex
elements.</p>
<p>So, looking again at our whole UI definition:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># --- User interface ---</span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidPage</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/titlePanel.html" class="external-link">titlePanel</a></span><span class="op">(</span><span class="st">"SEIRV model with interventions"</span><span class="op">)</span>,</span>
<span></span>
<span>    <span class="co"># 3 columns of inputs</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidRow</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html" class="external-link">column</a></span><span class="op">(</span><span class="fl">4</span>,</span>
<span>            <span class="co"># Basic epidemic settings</span></span>
<span>            <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">h3</a></span><span class="op">(</span><span class="st">"Epidemic"</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html" class="external-link">column</a></span><span class="op">(</span><span class="fl">4</span>,</span>
<span>            <span class="co"># Pathogen settings</span></span>
<span>            <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">h3</a></span><span class="op">(</span><span class="st">"Pathogen"</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html" class="external-link">column</a></span><span class="op">(</span><span class="fl">4</span>,</span>
<span>            <span class="co"># Intervention settings</span></span>
<span>            <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">h3</a></span><span class="op">(</span><span class="st">"Interventions"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This defines a <code>fluidPage</code> with 12 columns. There is a
<code>titlePanel</code> at the top; anything not explicitly in a
<code>fluidRow</code> takes up a whole row, so the title panel appears
on its own row. Then there is a <code>fluidRow</code> with three
<code>column</code>s each of size 4 (to add up to 12); the size of the
column is the first parameter to <code>column</code> and then all the
elements that should appear in the column are subsequent arguments.
Here, each column contains a header <code>h3</code> with some text. In
HTML, <code>h1</code> through <code>h6</code> define headers for
sections, where <code>h1</code> is the biggest and <code>h6</code> is
the smallest. You don’t need to start at <code>h1</code> and work your
way down, and often people select header levels (<code>h1</code> through
<code>h6</code>) based on aesthetics (i.e. which size looks right)
rather than a strict logical ordering, which is what we have done here.
To be clear, there’s no direct relationship between the header level and
the column size.</p>
<div class="section level3">
<h3 id="adding-input-widgets">Adding input widgets<a class="anchor" aria-label="anchor" href="#adding-input-widgets"></a>
</h3>
<p>Now we’ll edit our Shiny app skeleton to have some more interesting
things going on. Take a look at the code below and how it expands on the
user interface we defined above, then run the whole excerpt:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">epidemics</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.posit.co/" class="external-link">shiny</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># --- User interface ---</span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidPage</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/titlePanel.html" class="external-link">titlePanel</a></span><span class="op">(</span><span class="st">"SEIRV model with interventions"</span><span class="op">)</span>,</span>
<span></span>
<span>    <span class="co"># 3 columns of inputs</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidRow</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html" class="external-link">column</a></span><span class="op">(</span><span class="fl">4</span>,</span>
<span>            <span class="co"># Basic epidemic settings</span></span>
<span>            <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">h3</a></span><span class="op">(</span><span class="st">"Epidemic"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/dateRangeInput.html" class="external-link">dateRangeInput</a></span><span class="op">(</span><span class="st">"date_range"</span>, <span class="st">"Date range"</span>, start <span class="op">=</span> <span class="st">"2025-01-01"</span>, end <span class="op">=</span> <span class="st">"2025-12-31"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/numericInput.html" class="external-link">numericInput</a></span><span class="op">(</span><span class="st">"pop_size"</span>, <span class="st">"Population size (millions)"</span>, value <span class="op">=</span> <span class="fl">59</span>, min <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html" class="external-link">sliderInput</a></span><span class="op">(</span><span class="st">"init_infec"</span>, <span class="st">"Initial proportion infectious (%)"</span>, value <span class="op">=</span> <span class="fl">0.1</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">1</span>, step <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html" class="external-link">column</a></span><span class="op">(</span><span class="fl">4</span>,</span>
<span>            <span class="co"># Pathogen settings</span></span>
<span>            <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">h3</a></span><span class="op">(</span><span class="st">"Pathogen"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html" class="external-link">sliderInput</a></span><span class="op">(</span><span class="st">"R0"</span>, <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/HTML.html" class="external-link">HTML</a></span><span class="op">(</span><span class="st">"Basic reproduction number, &lt;i&gt;R&lt;/i&gt;&lt;sub&gt;0&lt;/sub&gt;"</span><span class="op">)</span>,</span>
<span>                value <span class="op">=</span> <span class="fl">1.3</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">5</span>, step <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html" class="external-link">sliderInput</a></span><span class="op">(</span><span class="st">"latent_pd"</span>, <span class="st">"Latent period (days)"</span>, value <span class="op">=</span> <span class="fl">2</span>, min <span class="op">=</span> <span class="fl">1</span>, max <span class="op">=</span> <span class="fl">7</span>, step <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html" class="external-link">sliderInput</a></span><span class="op">(</span><span class="st">"infec_pd"</span>, <span class="st">"Infectious period (days)"</span>, value <span class="op">=</span> <span class="fl">7</span>, min <span class="op">=</span> <span class="fl">1</span>, max <span class="op">=</span> <span class="fl">10</span>, step <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html" class="external-link">column</a></span><span class="op">(</span><span class="fl">4</span>,</span>
<span>            <span class="co"># Overlay controls: tokens that can be dragged onto the plot</span></span>
<span>            <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">h3</a></span><span class="op">(</span><span class="st">"Interventions"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># --- App logic ---</span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># --- Run app ---</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></span></code></pre></div>
<p>Now we’re getting somewhere! We’ve added some input widgets to the
first two columns. <code>shiny</code> gives us, among others,
<code><a href="https://rdrr.io/pkg/shiny/man/dateRangeInput.html" class="external-link">dateRangeInput()</a></code> to put in a range of dates (you can use
<code><a href="https://rdrr.io/pkg/shiny/man/dateInput.html" class="external-link">dateInput()</a></code> for just one date); <code><a href="https://rdrr.io/pkg/shiny/man/numericInput.html" class="external-link">numericInput()</a></code>
to enter a number using an input box (or <code><a href="https://rdrr.io/pkg/shiny/man/textInput.html" class="external-link">textInput()</a></code> for
free text input); and <code><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html" class="external-link">sliderInput()</a></code> to enter a number using
a slider. <code>shiny</code> also provides lots of other functions
called <code>xxxInput()</code> which follow some common conventions: the
first argument is a special ID which we’ll use later, the second
argument is a label to show next to the input, and then the other inputs
define things like the starting value or the minimum and maximum. For
more information, consult the <code>shiny</code> manual with
e.g. <code><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html" class="external-link">?sliderInput</a></code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="combining-inputs-and-outputs">Combining inputs and outputs<a class="anchor" aria-label="anchor" href="#combining-inputs-and-outputs"></a>
</h2>
<p>Now what we want to do is combine our previous
<code>run_model()</code> function with these <code>shiny</code> inputs
so that the inputs connect to the model. Also, we want to plot the
results of the model. Let’s do that now.</p>
<p>First, in a new file, paste in your <code>run_model()</code> function
from before with the calls to <code>library</code> that we need. Nothing
here is new:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.posit.co/" class="external-link">shiny</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">epidemics</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Model run function</span></span>
<span><span class="va">run_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>    <span class="co"># Transform parameters</span></span>
<span>    <span class="va">I0</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">init_infec</span> <span class="op">/</span> <span class="fl">100</span>; <span class="co"># Percent to proportion</span></span>
<span>    <span class="va">duration</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">date_range</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">input</span><span class="op">$</span><span class="va">date_range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="co"># Dates to duration</span></span>
<span>    <span class="va">infec_rate</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">input</span><span class="op">$</span><span class="va">latent_pd</span> <span class="co"># Latent period to infectiousness rate</span></span>
<span>    <span class="va">recov_rate</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">input</span><span class="op">$</span><span class="va">infec_pd</span>  <span class="co"># Infectious period to recovery rate</span></span>
<span>    <span class="va">trans_rate</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">R0</span> <span class="op">*</span> <span class="va">recov_rate</span> <span class="co"># R0 to transmission rate (R_0 = beta / gamma)</span></span>
<span></span>
<span>    <span class="co"># Build population</span></span>
<span>    <span class="va">pop</span> <span class="op">&lt;-</span> <span class="fu">population</span><span class="op">(</span></span>
<span>        name <span class="op">=</span> <span class="st">"Utopia"</span>,</span>
<span>        contact_matrix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        demography_vector <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">pop_size</span> <span class="op">*</span> <span class="fl">1000000</span>, <span class="co"># Population size in millions</span></span>
<span>        initial_conditions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">I0</span>, <span class="fl">0</span>, <span class="va">I0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Run model</span></span>
<span>    <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">model_default</span><span class="op">(</span><span class="va">pop</span>, transmission_rate <span class="op">=</span> <span class="va">trans_rate</span>,</span>
<span>        infectiousness_rate <span class="op">=</span> <span class="va">infec_rate</span>, recovery_rate <span class="op">=</span> <span class="va">recov_rate</span>,</span>
<span>        time_end <span class="op">=</span> <span class="va">duration</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span> <span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Underneath that, let’s put in our user interface from before, with
one addition:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># --- User interface ---</span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidPage</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/titlePanel.html" class="external-link">titlePanel</a></span><span class="op">(</span><span class="st">"SEIRV model with interventions"</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="co"># NEW PART IS HERE:</span></span>
<span>    <span class="co"># Main plot</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html" class="external-link">plotOutput</a></span><span class="op">(</span><span class="st">"plot"</span>, width <span class="op">=</span> <span class="st">"100%"</span>, height <span class="op">=</span> <span class="fl">400</span><span class="op">)</span>,</span>
<span>    <span class="co"># END OF NEW PART</span></span>
<span></span>
<span>    <span class="co"># 3 columns of inputs</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidRow</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html" class="external-link">column</a></span><span class="op">(</span><span class="fl">4</span>,</span>
<span>            <span class="co"># Basic epidemic settings</span></span>
<span>            <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">h3</a></span><span class="op">(</span><span class="st">"Epidemic"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/dateRangeInput.html" class="external-link">dateRangeInput</a></span><span class="op">(</span><span class="st">"date_range"</span>, <span class="st">"Date range"</span>, start <span class="op">=</span> <span class="st">"2025-01-01"</span>, end <span class="op">=</span> <span class="st">"2025-12-31"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/numericInput.html" class="external-link">numericInput</a></span><span class="op">(</span><span class="st">"pop_size"</span>, <span class="st">"Population size (millions)"</span>, value <span class="op">=</span> <span class="fl">59</span>, min <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html" class="external-link">sliderInput</a></span><span class="op">(</span><span class="st">"init_infec"</span>, <span class="st">"Initial proportion infectious (%)"</span>, value <span class="op">=</span> <span class="fl">0.1</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">1</span>, step <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html" class="external-link">column</a></span><span class="op">(</span><span class="fl">4</span>,</span>
<span>            <span class="co"># Pathogen settings</span></span>
<span>            <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">h3</a></span><span class="op">(</span><span class="st">"Pathogen"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html" class="external-link">sliderInput</a></span><span class="op">(</span><span class="st">"R0"</span>, <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/HTML.html" class="external-link">HTML</a></span><span class="op">(</span><span class="st">"Basic reproduction number, &lt;i&gt;R&lt;/i&gt;&lt;sub&gt;0&lt;/sub&gt;"</span><span class="op">)</span>,</span>
<span>                value <span class="op">=</span> <span class="fl">1.3</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">5</span>, step <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html" class="external-link">sliderInput</a></span><span class="op">(</span><span class="st">"latent_pd"</span>, <span class="st">"Latent period (days)"</span>, value <span class="op">=</span> <span class="fl">2</span>, min <span class="op">=</span> <span class="fl">1</span>, max <span class="op">=</span> <span class="fl">7</span>, step <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html" class="external-link">sliderInput</a></span><span class="op">(</span><span class="st">"infec_pd"</span>, <span class="st">"Infectious period (days)"</span>, value <span class="op">=</span> <span class="fl">7</span>, min <span class="op">=</span> <span class="fl">1</span>, max <span class="op">=</span> <span class="fl">10</span>, step <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html" class="external-link">column</a></span><span class="op">(</span><span class="fl">4</span>,</span>
<span>            <span class="co"># Overlay controls: tokens that can be dragged onto the plot</span></span>
<span>            <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">h3</a></span><span class="op">(</span><span class="st">"Interventions"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The bit we added was a <code>plotOutput</code> call, which puts space
in the app for a plot (either <code>ggplot2</code> or base R plot) with
the ID <code>"plot"</code>. To connect this plot with the inputs, we
need to add some code to our <code>server</code> function, so put this
code underneath what you have already:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># --- App logic ---</span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>    <span class="va">output</span><span class="op">$</span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html" class="external-link">renderPlot</a></span><span class="op">(</span><span class="op">{</span></span>
<span>        <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">run_model</span><span class="op">(</span><span class="va">input</span><span class="op">)</span></span>
<span>        <span class="va">results</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">[</span><span class="va">results</span><span class="op">$</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"infectious"</span>, <span class="op">]</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="st">"Infection prevalence"</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># --- Run app ---</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></span></code></pre></div>
<p>If you put all this together, you should have a working model that
connects to the user input, where the epidemic curve changes depending
on how you manipulate the various input controls.</p>
<p>Before continuing, let’s tidy up the output a little. First of all,
the y-axis of the plot extends up into the millions, and numbers like
“1e+06” are a little tough to interpret. Try changing the plotting code
in the <code>server</code> function so that the output is in thousands
and this is indicated on the y-axis label.</p>
<p>Second, the x-axis is in days from 0 to the duration of the epidemic,
but we are providing our <code>shiny</code> app with specific dates. Try
making the x-axis show calendar dates instead of the number of days from
the beginning of the epidemic. (Hint: you can use the <code>input</code>
list here.)</p>
<details><summary>
Click for one possible answer
</summary><p>Here’s how you might make these changes to the <code>server</code>
function just by changing the call to <code>ggplot</code>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span> <span class="op">+</span> <span class="va">input</span><span class="op">$</span><span class="va">date_range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">value</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="st">"Infection prevalence (thousands)"</span><span class="op">)</span></span></code></pre></div>
</details>
</div>
<div class="section level2">
<h2 id="adding-interventions-with-overshiny">Adding interventions with <code>overshiny</code><a class="anchor" aria-label="anchor" href="#adding-interventions-with-overshiny"></a>
</h2>
<p>In the last part of this tutorial, let’s finally connect our
<code>shiny</code> app with <code>overshiny</code> so that we can deploy
interventions such as social distancing and vaccination on our
infectious disease transmission model. We’re not going to get into the
fine details of how specifically to model these interventions, this is
more just to demonsrate how <code>overshiny</code> works in the context
of the model we’ve developed.</p>
<p>Starting from the code we developed in the last section:</p>
<details><summary>
Click for starter code…
</summary><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.posit.co/" class="external-link">shiny</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">epidemics</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Model run function</span></span>
<span><span class="va">run_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>    <span class="co"># Transform parameters</span></span>
<span>    <span class="va">I0</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">init_infec</span> <span class="op">/</span> <span class="fl">100</span>; <span class="co"># Percent to proportion</span></span>
<span>    <span class="va">duration</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">date_range</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">input</span><span class="op">$</span><span class="va">date_range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="co"># Dates to duration</span></span>
<span>    <span class="va">infec_rate</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">input</span><span class="op">$</span><span class="va">latent_pd</span> <span class="co"># Latent period to infectiousness rate</span></span>
<span>    <span class="va">recov_rate</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">input</span><span class="op">$</span><span class="va">infec_pd</span>  <span class="co"># Infectious period to recovery rate</span></span>
<span>    <span class="va">trans_rate</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">R0</span> <span class="op">*</span> <span class="va">recov_rate</span> <span class="co"># R0 to transmission rate (R_0 = beta / gamma)</span></span>
<span></span>
<span>    <span class="co"># Build population</span></span>
<span>    <span class="va">pop</span> <span class="op">&lt;-</span> <span class="fu">population</span><span class="op">(</span></span>
<span>        name <span class="op">=</span> <span class="st">"Utopia"</span>,</span>
<span>        contact_matrix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        demography_vector <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">pop_size</span> <span class="op">*</span> <span class="fl">1000000</span>, <span class="co"># Population size in millions</span></span>
<span>        initial_conditions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">I0</span>, <span class="fl">0</span>, <span class="va">I0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Run model</span></span>
<span>    <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">model_default</span><span class="op">(</span><span class="va">pop</span>, transmission_rate <span class="op">=</span> <span class="va">trans_rate</span>,</span>
<span>        infectiousness_rate <span class="op">=</span> <span class="va">infec_rate</span>, recovery_rate <span class="op">=</span> <span class="va">recov_rate</span>,</span>
<span>        time_end <span class="op">=</span> <span class="va">duration</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span> <span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># --- User interface ---</span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidPage</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/titlePanel.html" class="external-link">titlePanel</a></span><span class="op">(</span><span class="st">"SEIRV model with interventions"</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="co"># NEW PART IS HERE:</span></span>
<span>    <span class="co"># Main plot</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html" class="external-link">plotOutput</a></span><span class="op">(</span><span class="st">"plot"</span>, width <span class="op">=</span> <span class="st">"100%"</span>, height <span class="op">=</span> <span class="fl">400</span><span class="op">)</span>,</span>
<span>    <span class="co"># END OF NEW PART</span></span>
<span></span>
<span>    <span class="co"># 3 columns of inputs</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidRow</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html" class="external-link">column</a></span><span class="op">(</span><span class="fl">4</span>,</span>
<span>            <span class="co"># Basic epidemic settings</span></span>
<span>            <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">h3</a></span><span class="op">(</span><span class="st">"Epidemic"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/dateRangeInput.html" class="external-link">dateRangeInput</a></span><span class="op">(</span><span class="st">"date_range"</span>, <span class="st">"Date range"</span>, start <span class="op">=</span> <span class="st">"2025-01-01"</span>, end <span class="op">=</span> <span class="st">"2025-12-31"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/numericInput.html" class="external-link">numericInput</a></span><span class="op">(</span><span class="st">"pop_size"</span>, <span class="st">"Population size (millions)"</span>, value <span class="op">=</span> <span class="fl">59</span>, min <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html" class="external-link">sliderInput</a></span><span class="op">(</span><span class="st">"init_infec"</span>, <span class="st">"Initial proportion infectious (%)"</span>, value <span class="op">=</span> <span class="fl">0.1</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">1</span>, step <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html" class="external-link">column</a></span><span class="op">(</span><span class="fl">4</span>,</span>
<span>            <span class="co"># Pathogen settings</span></span>
<span>            <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">h3</a></span><span class="op">(</span><span class="st">"Pathogen"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html" class="external-link">sliderInput</a></span><span class="op">(</span><span class="st">"R0"</span>, <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/HTML.html" class="external-link">HTML</a></span><span class="op">(</span><span class="st">"Basic reproduction number, &lt;i&gt;R&lt;/i&gt;&lt;sub&gt;0&lt;/sub&gt;"</span><span class="op">)</span>,</span>
<span>                value <span class="op">=</span> <span class="fl">1.3</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">5</span>, step <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html" class="external-link">sliderInput</a></span><span class="op">(</span><span class="st">"latent_pd"</span>, <span class="st">"Latent period (days)"</span>, value <span class="op">=</span> <span class="fl">2</span>, min <span class="op">=</span> <span class="fl">1</span>, max <span class="op">=</span> <span class="fl">7</span>, step <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html" class="external-link">sliderInput</a></span><span class="op">(</span><span class="st">"infec_pd"</span>, <span class="st">"Infectious period (days)"</span>, value <span class="op">=</span> <span class="fl">7</span>, min <span class="op">=</span> <span class="fl">1</span>, max <span class="op">=</span> <span class="fl">10</span>, step <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html" class="external-link">column</a></span><span class="op">(</span><span class="fl">4</span>,</span>
<span>            <span class="co"># Overlay controls: tokens that can be dragged onto the plot</span></span>
<span>            <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">h3</a></span><span class="op">(</span><span class="st">"Interventions"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># --- App logic ---</span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>    <span class="va">output</span><span class="op">$</span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html" class="external-link">renderPlot</a></span><span class="op">(</span><span class="op">{</span></span>
<span>        <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">run_model</span><span class="op">(</span><span class="va">input</span><span class="op">)</span></span>
<span>        <span class="va">results</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">[</span><span class="va">results</span><span class="op">$</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"infectious"</span>, <span class="op">]</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span> <span class="op">+</span> <span class="va">input</span><span class="op">$</span><span class="va">date_range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">value</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="st">"Infection prevalence (thousands)"</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># --- Run app ---</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></span></code></pre></div>
</details><p>First, we need to include the <code>overshiny</code> package
with:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nicholasdavies/overshiny" class="external-link">overshiny</a></span><span class="op">)</span></span></code></pre></div>
<p>Second, we need to change our <code>plotOutput</code> plot in our UI
to an <code>overlayPlotOutput</code> so that it can respond to
overlays:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>    <span class="co"># Main plot</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>    <span class="fu">overlayPlotOutput</span>(<span class="st">"plot"</span>, <span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="dv">400</span>),</span></code></pre></div>
<p>Third, we need to add some <code><a href="../reference/overlayToken.html">overlayToken()</a></code>s that can be
dragged onto the plot. Let’s put these into the currently-blank
“Interventions” section of our UI:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html" class="external-link">column</a></span><span class="op">(</span><span class="fl">4</span>,</span>
<span>            <span class="co"># Overlay controls: tokens that can be dragged onto the plot</span></span>
<span>            <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">h3</a></span><span class="op">(</span><span class="st">"Interventions"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="../reference/overlayToken.html">overlayToken</a></span><span class="op">(</span><span class="st">"vax"</span>, <span class="st">"Vaccination"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="../reference/overlayToken.html">overlayToken</a></span><span class="op">(</span><span class="st">"txi"</span>, <span class="st">"Transmission"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span></code></pre></div>
<p>Fourth, we need to initialize the overlay logic in our
<code>server</code> function by putting a call to
<code>overlayServer</code> at the top of the <code>server</code>
function:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="co"># --- App logic ---</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output)</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>{</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>    <span class="co"># --- OVERLAY SETUP ---</span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>    <span class="co"># Initialise 8 draggable/resizable overlays</span></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a>    ov <span class="ot">&lt;-</span> <span class="fu">overlayServer</span>(<span class="st">"plot"</span>, <span class="dv">8</span>)</span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a>    <span class="co"># rest of code follows as normal...</span></span></code></pre></div>
<p>And finally, we need to modify our call to <code><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html" class="external-link">renderPlot()</a></code>
in the <code>server</code> function to tell <code>overshiny</code> more
information about our plot. Where before we had:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>    <span class="va">output</span><span class="op">$</span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html" class="external-link">renderPlot</a></span><span class="op">(</span><span class="op">{</span></span>
<span>        <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">run_model</span><span class="op">(</span><span class="va">input</span><span class="op">)</span></span>
<span>        <span class="va">results</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">[</span><span class="va">results</span><span class="op">$</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"infectious"</span>, <span class="op">]</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span> <span class="op">+</span> <span class="va">input</span><span class="op">$</span><span class="va">date_range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">value</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="st">"Infection prevalence (thousands)"</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Now, we have:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>    <span class="va">output</span><span class="op">$</span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html" class="external-link">renderPlot</a></span><span class="op">(</span><span class="op">{</span></span>
<span>        <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">run_model</span><span class="op">(</span><span class="va">input</span><span class="op">)</span></span>
<span>        <span class="va">results</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">[</span><span class="va">results</span><span class="op">$</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"infectious"</span>, <span class="op">]</span></span>
<span>        <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span> <span class="op">+</span> <span class="va">input</span><span class="op">$</span><span class="va">date_range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">value</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="st">"Infection prevalence (thousands)"</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="fu"><a href="../reference/overlayBounds.html">overlayBounds</a></span><span class="op">(</span><span class="va">ov</span>, <span class="va">plot</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">date_range</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>There are two changes above. First, rather than returning the
<code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot()</a></code> plot, we save the plot in a variable called
<code>plot</code>. Second, we pass this through
<code><a href="../reference/overlayBounds.html">overlayBounds()</a></code>, which takes four key arguments:</p>
<ul>
<li>
<code>ov</code>, the object returned by
<code><a href="../reference/overlayServer.html">overlayServer()</a></code>.</li>
<li>
<code>plot</code>, the plot itself.</li>
<li>
<code>xlim</code>, the x-coordinate limits of the plot.</li>
<li>
<code>ylim</code>, the y-coordinate limits of the plot.</li>
</ul>
<p><code>xlim</code> and <code>ylim</code> are not required, but because
<code>ggplot</code> by default includes a bit of extra space around the
plotted elements (i.e. the x-axis doesn’t start right at the epidemic
start date, but a little before), providing these allows
<code>overshiny</code> to restrict where the overlays can move to the
region where the epidemic is actually running. It’s similar for
<code>ylim</code> (try removing the <code>xlim</code> and
<code>ylim</code> arguments to <code>overlayBounds</code> to see what
happens.)</p>
<p>You should now be able to drag the intervention tokens onto the plot,
where they will become overlays that you can move around, resize, and
remove by clicking on the “gears” icon on each overlay. They won’t do
anything yet to the epicurve, though. If you’ve gotten stuck, here’s the
code you could have arrived at:</p>
<details><summary>
Click for code…
</summary><div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.posit.co/" class="external-link">shiny</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">epidemics</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nicholasdavies/overshiny" class="external-link">overshiny</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Model run function</span></span>
<span><span class="va">run_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>    <span class="co"># Transform parameters</span></span>
<span>    <span class="va">I0</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">init_infec</span> <span class="op">/</span> <span class="fl">100</span>; <span class="co"># Percent to proportion</span></span>
<span>    <span class="va">duration</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">date_range</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">input</span><span class="op">$</span><span class="va">date_range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="co"># Dates to duration</span></span>
<span>    <span class="va">infec_rate</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">input</span><span class="op">$</span><span class="va">latent_pd</span> <span class="co"># Latent period to infectiousness rate</span></span>
<span>    <span class="va">recov_rate</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">input</span><span class="op">$</span><span class="va">infec_pd</span>  <span class="co"># Infectious period to recovery rate</span></span>
<span>    <span class="va">trans_rate</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">R0</span> <span class="op">*</span> <span class="va">recov_rate</span> <span class="co"># R0 to transmission rate (R_0 = beta / gamma)</span></span>
<span></span>
<span>    <span class="co"># Build population</span></span>
<span>    <span class="va">pop</span> <span class="op">&lt;-</span> <span class="fu">population</span><span class="op">(</span></span>
<span>        name <span class="op">=</span> <span class="st">"Utopia"</span>,</span>
<span>        contact_matrix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        demography_vector <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">pop_size</span> <span class="op">*</span> <span class="fl">1000000</span>, <span class="co"># Population size in millions</span></span>
<span>        initial_conditions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">I0</span>, <span class="fl">0</span>, <span class="va">I0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Run model</span></span>
<span>    <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">model_default</span><span class="op">(</span><span class="va">pop</span>, transmission_rate <span class="op">=</span> <span class="va">trans_rate</span>,</span>
<span>        infectiousness_rate <span class="op">=</span> <span class="va">infec_rate</span>, recovery_rate <span class="op">=</span> <span class="va">recov_rate</span>,</span>
<span>        time_end <span class="op">=</span> <span class="va">duration</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span> <span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># --- User interface ---</span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidPage</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/titlePanel.html" class="external-link">titlePanel</a></span><span class="op">(</span><span class="st">"SEIRV model with interventions"</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="co"># NEW PART IS HERE:</span></span>
<span>    <span class="co"># Main plot</span></span>
<span>    <span class="fu"><a href="../reference/overlayPlotOutput.html">overlayPlotOutput</a></span><span class="op">(</span><span class="st">"plot"</span>, width <span class="op">=</span> <span class="st">"100%"</span>, height <span class="op">=</span> <span class="fl">400</span><span class="op">)</span>,</span>
<span>    <span class="co"># END OF NEW PART</span></span>
<span></span>
<span>    <span class="co"># 3 columns of inputs</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidRow</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html" class="external-link">column</a></span><span class="op">(</span><span class="fl">4</span>,</span>
<span>            <span class="co"># Basic epidemic settings</span></span>
<span>            <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">h3</a></span><span class="op">(</span><span class="st">"Epidemic"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/dateRangeInput.html" class="external-link">dateRangeInput</a></span><span class="op">(</span><span class="st">"date_range"</span>, <span class="st">"Date range"</span>, start <span class="op">=</span> <span class="st">"2025-01-01"</span>, end <span class="op">=</span> <span class="st">"2025-12-31"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/numericInput.html" class="external-link">numericInput</a></span><span class="op">(</span><span class="st">"pop_size"</span>, <span class="st">"Population size (millions)"</span>, value <span class="op">=</span> <span class="fl">59</span>, min <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html" class="external-link">sliderInput</a></span><span class="op">(</span><span class="st">"init_infec"</span>, <span class="st">"Initial proportion infectious (%)"</span>, value <span class="op">=</span> <span class="fl">0.1</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">1</span>, step <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html" class="external-link">column</a></span><span class="op">(</span><span class="fl">4</span>,</span>
<span>            <span class="co"># Pathogen settings</span></span>
<span>            <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">h3</a></span><span class="op">(</span><span class="st">"Pathogen"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html" class="external-link">sliderInput</a></span><span class="op">(</span><span class="st">"R0"</span>, <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/HTML.html" class="external-link">HTML</a></span><span class="op">(</span><span class="st">"Basic reproduction number, &lt;i&gt;R&lt;/i&gt;&lt;sub&gt;0&lt;/sub&gt;"</span><span class="op">)</span>,</span>
<span>                value <span class="op">=</span> <span class="fl">1.3</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">5</span>, step <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html" class="external-link">sliderInput</a></span><span class="op">(</span><span class="st">"latent_pd"</span>, <span class="st">"Latent period (days)"</span>, value <span class="op">=</span> <span class="fl">2</span>, min <span class="op">=</span> <span class="fl">1</span>, max <span class="op">=</span> <span class="fl">7</span>, step <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html" class="external-link">sliderInput</a></span><span class="op">(</span><span class="st">"infec_pd"</span>, <span class="st">"Infectious period (days)"</span>, value <span class="op">=</span> <span class="fl">7</span>, min <span class="op">=</span> <span class="fl">1</span>, max <span class="op">=</span> <span class="fl">10</span>, step <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html" class="external-link">column</a></span><span class="op">(</span><span class="fl">4</span>,</span>
<span>            <span class="co"># Overlay controls: tokens that can be dragged onto the plot</span></span>
<span>            <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">h3</a></span><span class="op">(</span><span class="st">"Interventions"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="../reference/overlayToken.html">overlayToken</a></span><span class="op">(</span><span class="st">"vax"</span>, <span class="st">"Vaccination"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="../reference/overlayToken.html">overlayToken</a></span><span class="op">(</span><span class="st">"txi"</span>, <span class="st">"Transmission"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># --- App logic ---</span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>    <span class="co"># --- OVERLAY SETUP ---</span></span>
<span></span>
<span>    <span class="co"># Initialise 8 draggable/resizable overlays</span></span>
<span>    <span class="va">ov</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/overlayServer.html">overlayServer</a></span><span class="op">(</span><span class="st">"plot"</span>, <span class="fl">8</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># --- RENDERING OF EPI CURVES ---</span></span>
<span></span>
<span>    <span class="va">output</span><span class="op">$</span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html" class="external-link">renderPlot</a></span><span class="op">(</span><span class="op">{</span></span>
<span>        <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">run_model</span><span class="op">(</span><span class="va">input</span><span class="op">)</span></span>
<span>        <span class="va">results</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">[</span><span class="va">results</span><span class="op">$</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"infectious"</span>, <span class="op">]</span></span>
<span>        <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span> <span class="op">+</span> <span class="va">input</span><span class="op">$</span><span class="va">date_range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">value</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="st">"Infection prevalence (thousands)"</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="fu"><a href="../reference/overlayBounds.html">overlayBounds</a></span><span class="op">(</span><span class="va">ov</span>, <span class="va">plot</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">date_range</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># --- Run app ---</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></span></code></pre></div>
</details><p>That’s how <code>overshiny</code> works; the rest of this tutorial is
just about connecting <code>overshiny</code> with <code>epidemics</code>
so that the overlays on the plot actually have an effect on the epidemic
model.</p>
<div class="section level3">
<h3 id="making-the-interventions-work">Making the interventions work<a class="anchor" aria-label="anchor" href="#making-the-interventions-work"></a>
</h3>
<p>The last piece of the puzzle is to make the interventions actually
have an impact on what is being plotted. We are using the function
<code>model_default()</code> from <code>epidemics</code> to run our
model, and now we will use the <code>intervention</code> and
<code>vaccination</code> arguments to <code>model_default()</code> to
make our interventions work.</p>
<p>First, let’s change <code>run_model()</code> so that it can pass on
these extra parameters to <code>epidemics::model_default()</code>. To do
that, add a <code>...</code> to the list of parameters and pass these
extra parameters to <code>model_default()</code>, like so (there are
just two changes to make):</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="co"># Model run function</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>run_model <span class="ot">&lt;-</span> <span class="cf">function</span>(input, ...)  <span class="co"># &lt;-- FIRST CHANGE HERE</span></span></code></pre></div>
<p>… and then …</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>    <span class="co"># Run model</span></span>
<span>    <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">model_default</span><span class="op">(</span><span class="va">pop</span>, transmission_rate <span class="op">=</span> <span class="va">trans_rate</span>,</span>
<span>        infectiousness_rate <span class="op">=</span> <span class="va">infec_rate</span>, recovery_rate <span class="op">=</span> <span class="va">recov_rate</span>,</span>
<span>        time_end <span class="op">=</span> <span class="va">duration</span>, <span class="va">...</span><span class="op">)</span> <span class="co"># &lt;-- SECOND CHANGE HERE</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span> <span class="op">(</span><span class="va">results</span><span class="op">)</span></span></code></pre></div>
<p>Now, let’s modify the call to <code>renderPlot</code> so that it
reads in what interventions have been dragged onto the plot and fills
out the <code>intervention</code> and <code>vaccination</code>
parameters accordingly.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>    <span class="va">output</span><span class="op">$</span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html" class="external-link">renderPlot</a></span><span class="op">(</span><span class="op">{</span></span>
<span>        <span class="co"># Create interventions</span></span>
<span>        <span class="va">tx_int</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="va">vax</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>        </span>
<span>        <span class="co"># Apply overlays as interventions</span></span>
<span>        <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">ov</span><span class="op">$</span><span class="va">active</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">begin</span> <span class="op">&lt;-</span> <span class="va">ov</span><span class="op">$</span><span class="va">cx0</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">date_range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>            <span class="va">end</span> <span class="op">&lt;-</span> <span class="va">ov</span><span class="op">$</span><span class="va">cx1</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">date_range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="va">ov</span><span class="op">$</span><span class="va">label</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Vaccination"</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="va">nu</span> <span class="op">&lt;-</span> <span class="fl">0.01</span> <span class="co"># proportion of population vaccinated per day</span></span>
<span>                <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">vax</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>                    <span class="va">vax</span> <span class="op">&lt;-</span> <span class="fu">vaccination</span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>, nu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">nu</span><span class="op">)</span>,</span>
<span>                        time_begin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">begin</span><span class="op">)</span>, time_end <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">end</span><span class="op">)</span><span class="op">)</span></span>
<span>                <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>                    <span class="va">ov</span><span class="op">$</span><span class="va">active</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span>                <span class="op">}</span></span>
<span>            <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">ov</span><span class="op">$</span><span class="va">label</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Transmission"</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="va">reduc</span> <span class="op">&lt;-</span> <span class="fl">0.5</span> <span class="co"># reduction in transmission</span></span>
<span>                <span class="va">tx_int</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">tx_int</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">intervention</span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>,</span>
<span>                    type <span class="op">=</span> <span class="st">"rate"</span>, time_begin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">begin</span><span class="op">)</span>, time_end <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">end</span><span class="op">)</span>,</span>
<span>                    reduction <span class="op">=</span> <span class="va">reduc</span><span class="op">)</span></span>
<span>            <span class="op">}</span></span>
<span>        <span class="op">}</span></span>
<span></span>
<span>        <span class="co"># Put interventions in the right format</span></span>
<span>        <span class="va">int</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">tx_int</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">int</span><span class="op">[[</span><span class="st">"transmission_rate"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">c</span>, <span class="va">tx_int</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>        </span>
<span>        <span class="co"># Run model</span></span>
<span>        <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">run_model</span><span class="op">(</span><span class="va">input</span>,</span>
<span>            vaccination <span class="op">=</span> <span class="va">vax</span>,</span>
<span>            intervention <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">int</span><span class="op">)</span><span class="op">)</span> <span class="va">int</span> <span class="kw">else</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="co"># Process results (this is the same as before)</span></span>
<span>        <span class="va">results</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">[</span><span class="va">results</span><span class="op">$</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"infectious"</span>, <span class="op">]</span></span>
<span>        <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span> <span class="op">+</span> <span class="va">input</span><span class="op">$</span><span class="va">date_range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">value</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="st">"Infection prevalence (thousands)"</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="fu"><a href="../reference/overlayBounds.html">overlayBounds</a></span><span class="op">(</span><span class="va">ov</span>, <span class="va">plot</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">date_range</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<details><summary>
(Complete code for the whole script is here)
</summary><div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.posit.co/" class="external-link">shiny</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">epidemics</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nicholasdavies/overshiny" class="external-link">overshiny</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Model run function</span></span>
<span><span class="va">run_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>    <span class="co"># Transform parameters</span></span>
<span>    <span class="va">I0</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">init_infec</span> <span class="op">/</span> <span class="fl">100</span>; <span class="co"># Percent to proportion</span></span>
<span>    <span class="va">duration</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">date_range</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">input</span><span class="op">$</span><span class="va">date_range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="co"># Dates to duration</span></span>
<span>    <span class="va">infec_rate</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">input</span><span class="op">$</span><span class="va">latent_pd</span> <span class="co"># Latent period to infectiousness rate</span></span>
<span>    <span class="va">recov_rate</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">input</span><span class="op">$</span><span class="va">infec_pd</span>  <span class="co"># Infectious period to recovery rate</span></span>
<span>    <span class="va">trans_rate</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">R0</span> <span class="op">*</span> <span class="va">recov_rate</span> <span class="co"># R0 to transmission rate (R_0 = beta / gamma)</span></span>
<span></span>
<span>    <span class="co"># Build population</span></span>
<span>    <span class="va">pop</span> <span class="op">&lt;-</span> <span class="fu">population</span><span class="op">(</span></span>
<span>        name <span class="op">=</span> <span class="st">"Utopia"</span>,</span>
<span>        contact_matrix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        demography_vector <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">pop_size</span> <span class="op">*</span> <span class="fl">1000000</span>, <span class="co"># Population size in millions</span></span>
<span>        initial_conditions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">I0</span>, <span class="fl">0</span>, <span class="va">I0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Run model</span></span>
<span>    <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">model_default</span><span class="op">(</span><span class="va">pop</span>, transmission_rate <span class="op">=</span> <span class="va">trans_rate</span>,</span>
<span>        infectiousness_rate <span class="op">=</span> <span class="va">infec_rate</span>, recovery_rate <span class="op">=</span> <span class="va">recov_rate</span>,</span>
<span>        time_end <span class="op">=</span> <span class="va">duration</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span> <span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># --- User interface ---</span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidPage</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/titlePanel.html" class="external-link">titlePanel</a></span><span class="op">(</span><span class="st">"SEIRV model with interventions"</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="co"># NEW PART IS HERE:</span></span>
<span>    <span class="co"># Main plot</span></span>
<span>    <span class="fu"><a href="../reference/overlayPlotOutput.html">overlayPlotOutput</a></span><span class="op">(</span><span class="st">"plot"</span>, width <span class="op">=</span> <span class="st">"100%"</span>, height <span class="op">=</span> <span class="fl">400</span><span class="op">)</span>,</span>
<span>    <span class="co"># END OF NEW PART</span></span>
<span></span>
<span>    <span class="co"># 3 columns of inputs</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidRow</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html" class="external-link">column</a></span><span class="op">(</span><span class="fl">4</span>,</span>
<span>            <span class="co"># Basic epidemic settings</span></span>
<span>            <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">h3</a></span><span class="op">(</span><span class="st">"Epidemic"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/dateRangeInput.html" class="external-link">dateRangeInput</a></span><span class="op">(</span><span class="st">"date_range"</span>, <span class="st">"Date range"</span>, start <span class="op">=</span> <span class="st">"2025-01-01"</span>, end <span class="op">=</span> <span class="st">"2025-12-31"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/numericInput.html" class="external-link">numericInput</a></span><span class="op">(</span><span class="st">"pop_size"</span>, <span class="st">"Population size (millions)"</span>, value <span class="op">=</span> <span class="fl">59</span>, min <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html" class="external-link">sliderInput</a></span><span class="op">(</span><span class="st">"init_infec"</span>, <span class="st">"Initial proportion infectious (%)"</span>, value <span class="op">=</span> <span class="fl">0.1</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">1</span>, step <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html" class="external-link">column</a></span><span class="op">(</span><span class="fl">4</span>,</span>
<span>            <span class="co"># Pathogen settings</span></span>
<span>            <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">h3</a></span><span class="op">(</span><span class="st">"Pathogen"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html" class="external-link">sliderInput</a></span><span class="op">(</span><span class="st">"R0"</span>, <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/HTML.html" class="external-link">HTML</a></span><span class="op">(</span><span class="st">"Basic reproduction number, &lt;i&gt;R&lt;/i&gt;&lt;sub&gt;0&lt;/sub&gt;"</span><span class="op">)</span>,</span>
<span>                value <span class="op">=</span> <span class="fl">1.3</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">5</span>, step <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html" class="external-link">sliderInput</a></span><span class="op">(</span><span class="st">"latent_pd"</span>, <span class="st">"Latent period (days)"</span>, value <span class="op">=</span> <span class="fl">2</span>, min <span class="op">=</span> <span class="fl">1</span>, max <span class="op">=</span> <span class="fl">7</span>, step <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html" class="external-link">sliderInput</a></span><span class="op">(</span><span class="st">"infec_pd"</span>, <span class="st">"Infectious period (days)"</span>, value <span class="op">=</span> <span class="fl">7</span>, min <span class="op">=</span> <span class="fl">1</span>, max <span class="op">=</span> <span class="fl">10</span>, step <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html" class="external-link">column</a></span><span class="op">(</span><span class="fl">4</span>,</span>
<span>            <span class="co"># Overlay controls: tokens that can be dragged onto the plot</span></span>
<span>            <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">h3</a></span><span class="op">(</span><span class="st">"Interventions"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="../reference/overlayToken.html">overlayToken</a></span><span class="op">(</span><span class="st">"vax"</span>, <span class="st">"Vaccination"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="../reference/overlayToken.html">overlayToken</a></span><span class="op">(</span><span class="st">"txi"</span>, <span class="st">"Transmission"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># --- App logic ---</span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>    <span class="co"># --- OVERLAY SETUP ---</span></span>
<span></span>
<span>    <span class="co"># Initialise 8 draggable/resizable overlays</span></span>
<span>    <span class="va">ov</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/overlayServer.html">overlayServer</a></span><span class="op">(</span><span class="st">"plot"</span>, <span class="fl">8</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># --- RENDERING OF EPI CURVES ---</span></span>
<span></span>
<span>    <span class="va">output</span><span class="op">$</span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html" class="external-link">renderPlot</a></span><span class="op">(</span><span class="op">{</span></span>
<span>        <span class="co"># Create interventions</span></span>
<span>        <span class="va">tx_int</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="va">vax</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>        </span>
<span>        <span class="co"># Apply overlays as interventions</span></span>
<span>        <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">ov</span><span class="op">$</span><span class="va">active</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">begin</span> <span class="op">&lt;-</span> <span class="va">ov</span><span class="op">$</span><span class="va">cx0</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">date_range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>            <span class="va">end</span> <span class="op">&lt;-</span> <span class="va">ov</span><span class="op">$</span><span class="va">cx1</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">date_range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="va">ov</span><span class="op">$</span><span class="va">label</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Vaccination"</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="va">nu</span> <span class="op">&lt;-</span> <span class="fl">0.01</span> <span class="co"># proportion of population vaccinated per day</span></span>
<span>                <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">vax</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>                    <span class="va">vax</span> <span class="op">&lt;-</span> <span class="fu">vaccination</span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>, nu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">nu</span><span class="op">)</span>,</span>
<span>                        time_begin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">begin</span><span class="op">)</span>, time_end <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">end</span><span class="op">)</span><span class="op">)</span></span>
<span>                <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>                    <span class="va">ov</span><span class="op">$</span><span class="va">active</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span>                <span class="op">}</span></span>
<span>            <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">ov</span><span class="op">$</span><span class="va">label</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Transmission"</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="va">reduc</span> <span class="op">&lt;-</span> <span class="fl">0.5</span> <span class="co"># reduction in transmission</span></span>
<span>                <span class="va">tx_int</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">tx_int</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">intervention</span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>,</span>
<span>                    type <span class="op">=</span> <span class="st">"rate"</span>, time_begin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">begin</span><span class="op">)</span>, time_end <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">end</span><span class="op">)</span>,</span>
<span>                    reduction <span class="op">=</span> <span class="va">reduc</span><span class="op">)</span></span>
<span>            <span class="op">}</span></span>
<span>        <span class="op">}</span></span>
<span></span>
<span>        <span class="co"># Put interventions in the right format</span></span>
<span>        <span class="va">int</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">tx_int</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">int</span><span class="op">[[</span><span class="st">"transmission_rate"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">c</span>, <span class="va">tx_int</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>        </span>
<span>        <span class="co"># Run model</span></span>
<span>        <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">run_model</span><span class="op">(</span><span class="va">input</span>,</span>
<span>            vaccination <span class="op">=</span> <span class="va">vax</span>,</span>
<span>            intervention <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">int</span><span class="op">)</span><span class="op">)</span> <span class="va">int</span> <span class="kw">else</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="co"># Process results (this is the same as before)</span></span>
<span>        <span class="va">results</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">[</span><span class="va">results</span><span class="op">$</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"infectious"</span>, <span class="op">]</span></span>
<span>        <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span> <span class="op">+</span> <span class="va">input</span><span class="op">$</span><span class="va">date_range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">value</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="st">"Infection prevalence (thousands)"</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="fu"><a href="../reference/overlayBounds.html">overlayBounds</a></span><span class="op">(</span><span class="va">ov</span>, <span class="va">plot</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">date_range</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># --- Run app ---</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></span></code></pre></div>
</details><p>Compare the new call to <code><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html" class="external-link">renderPlot()</a></code> to what we had
before, which was:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>    <span class="va">output</span><span class="op">$</span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html" class="external-link">renderPlot</a></span><span class="op">(</span><span class="op">{</span></span>
<span>        <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">run_model</span><span class="op">(</span><span class="va">input</span><span class="op">)</span></span>
<span>        <span class="va">results</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">[</span><span class="va">results</span><span class="op">$</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"infectious"</span>, <span class="op">]</span></span>
<span>        <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span> <span class="op">+</span> <span class="va">input</span><span class="op">$</span><span class="va">date_range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">value</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="st">"Infection prevalence (thousands)"</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="fu"><a href="../reference/overlayBounds.html">overlayBounds</a></span><span class="op">(</span><span class="va">ov</span>, <span class="va">plot</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">date_range</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>A lot has changed, so let’s take it step by step. First:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>        <span class="co"># Create interventions</span></span>
<span>        <span class="va">tx_int</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="va">vax</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span></code></pre></div>
<p>Here, we create some variables that will hold details of the
interventions to apply; <code>tx_int</code> (for interventions on the
transmission rate) and <code>vax</code> (for a vaccination
campaign).</p>
<p>Then, we process the overlay data from the <code>ov</code> object
returned by <code><a href="../reference/overlayServer.html">overlayServer()</a></code>:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>        <span class="co"># Apply overlays as interventions</span></span>
<span>        <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">ov</span><span class="op">$</span><span class="va">active</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">begin</span> <span class="op">&lt;-</span> <span class="va">ov</span><span class="op">$</span><span class="va">cx0</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">date_range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>            <span class="va">end</span> <span class="op">&lt;-</span> <span class="va">ov</span><span class="op">$</span><span class="va">cx1</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">date_range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="va">ov</span><span class="op">$</span><span class="va">label</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Vaccination"</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="va">nu</span> <span class="op">&lt;-</span> <span class="fl">0.01</span> <span class="co"># proportion of population vaccinated per day</span></span>
<span>                <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">vax</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>                    <span class="va">vax</span> <span class="op">&lt;-</span> <span class="fu">vaccination</span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>, nu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">nu</span><span class="op">)</span>,</span>
<span>                        time_begin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">begin</span><span class="op">)</span>, time_end <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">end</span><span class="op">)</span><span class="op">)</span></span>
<span>                <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>                    <span class="va">ov</span><span class="op">$</span><span class="va">active</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span>                <span class="op">}</span></span>
<span>            <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">ov</span><span class="op">$</span><span class="va">label</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Transmission"</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="va">reduc</span> <span class="op">&lt;-</span> <span class="fl">0.5</span> <span class="co"># reduction in transmission</span></span>
<span>                <span class="va">tx_int</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">tx_int</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">intervention</span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>,</span>
<span>                    type <span class="op">=</span> <span class="st">"rate"</span>, time_begin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">begin</span><span class="op">)</span>, time_end <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">end</span><span class="op">)</span>,</span>
<span>                    reduction <span class="op">=</span> <span class="va">reduc</span><span class="op">)</span></span>
<span>            <span class="op">}</span></span>
<span>        <span class="op">}</span></span></code></pre></div>
<p><code>ov$active</code> is a logical vector, the same length as the
maximum number of overlays (here, 8), which is <code>TRUE</code> for
overlays that are on the plot and <code>FALSE</code> for overlays that
aren’t. So <code>for (i in which(ov$active))</code> runs a loop for all
indices <code>i</code> that correspond to an active overlay.</p>
<p>Then we read <code>begin</code> and <code>end</code> – the start time
and end time for each intervention – from <code>ov$cx0</code> (the
starting x-coordinate of each overlay) and from <code>ov$cx1</code> (the
ending x-coordinate of each overlay). We work out how many days into the
epidemic <code>begin</code> and <code>end</code> should be by
subtracting the numeric value of the start date of the epidemic,
<code>as.numeric(input$date_range[1])</code>.</p>
<p>Then, each overlay has a <code>label</code> which corresponds to the
<code>label</code> of the <code><a href="../reference/overlayToken.html">overlayToken()</a></code> which created it.
So we check whether the overlay with index <code>i</code> is a
<code>"Vaccination"</code> or a <code>"Transmission"</code>
intervention.</p>
<p>For vaccination overlays, we set the vaccination rate <code>nu</code>
to 0.01, which (to <code>epidemics</code>) means 1% of the population is
getting vaccinated per day. If there isn’t already a vaccination
intervention (and hence <code>vax</code> is <code>NULL</code>) then we
create one. If there is, then we can’t add a second vaccination
intervention since the <code>epidemics</code> package only allows one
vaccination intervention; so we deactivate the vaccine intervention if
one already exists.</p>
<p>For transmission overlays, we set the transmission reduction
<code>reduc</code> to 0.5, which means a reduction in the transmission
rate by 50%. We add our new intervention to the list
<code>tx_int</code>. <code>epidemics</code> <em>does</em> allow multiple
transmission-rate interventions, so we don’t need to limit the number of
these.</p>
<p>Next in the code, we have this:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>        <span class="co"># Put interventions in the right format</span></span>
<span>        <span class="va">int</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">tx_int</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">int</span><span class="op">[[</span><span class="st">"transmission_rate"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">c</span>, <span class="va">tx_int</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>        </span>
<span>        <span class="co"># Run model</span></span>
<span>        <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">run_model</span><span class="op">(</span><span class="va">input</span>,</span>
<span>            vaccination <span class="op">=</span> <span class="va">vax</span>,</span>
<span>            intervention <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">int</span><span class="op">)</span><span class="op">)</span> <span class="va">int</span> <span class="kw">else</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p>This just turns our list of transmission interventions
<code>tx_int</code> into the right format for <code>epidemics</code> to
understand, then calls our function <code>run_model</code> with the
appropriate intervention data for <code>vaccination</code> and
<code>intervention</code>.</p>
<p>Put this all together, and you have a working app with intervention
overlays!</p>
</div>
</div>
<div class="section level2">
<h2 id="next-steps">Next steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<p>We have come to the end of the tutorial. We haven’t explored
everything that <code>shiny</code> and <code>overshiny</code> can do,
but we have gone through the basics.</p>
<p>It would be nice to modify our app to do two things:</p>
<ol style="list-style-type: decimal">
<li>Compare the mitigated epidemic to the counterfactual, unmitigated
epidemic without any interventions.</li>
<li>Allow us to customize the vaccination rate and the strength of the
transmission interventions, instead of leaving these at 0.1% and 50%
respectively.</li>
</ol>
<p>The following code snippet shows you how to accomplish both of these
things. Use the <code>shiny</code> and <code>overshiny</code> package
documentation for insight into how these changes have been made. Good
luck!</p>
<details><summary>
Advanced code follows…
</summary><div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">epidemics</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.posit.co/" class="external-link">shiny</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nicholasdavies/overshiny" class="external-link">overshiny</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># --- User interface ---</span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidPage</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/titlePanel.html" class="external-link">titlePanel</a></span><span class="op">(</span><span class="st">"SEIRV model with interventions"</span><span class="op">)</span>,</span>
<span></span>
<span>    <span class="co"># Main plot with support for overlays</span></span>
<span>    <span class="fu"><a href="../reference/overlayPlotOutput.html">overlayPlotOutput</a></span><span class="op">(</span><span class="st">"plot"</span>, width <span class="op">=</span> <span class="st">"100%"</span>, height <span class="op">=</span> <span class="fl">400</span><span class="op">)</span>,</span>
<span></span>
<span>    <span class="co"># 3 columns of inputs</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidRow</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html" class="external-link">column</a></span><span class="op">(</span><span class="fl">4</span>,</span>
<span>            <span class="co"># Basic epidemic settings</span></span>
<span>            <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">h3</a></span><span class="op">(</span><span class="st">"Epidemic"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/dateRangeInput.html" class="external-link">dateRangeInput</a></span><span class="op">(</span><span class="st">"date_range"</span>, <span class="st">"Date range"</span>, start <span class="op">=</span> <span class="st">"2025-01-01"</span>, end <span class="op">=</span> <span class="st">"2025-12-31"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/numericInput.html" class="external-link">numericInput</a></span><span class="op">(</span><span class="st">"pop_size"</span>, <span class="st">"Population size (millions)"</span>, value <span class="op">=</span> <span class="fl">59</span>, min <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html" class="external-link">sliderInput</a></span><span class="op">(</span><span class="st">"init_infec"</span>, <span class="st">"Initial proportion infectious (%)"</span>, value <span class="op">=</span> <span class="fl">0.1</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">1</span>, step <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html" class="external-link">column</a></span><span class="op">(</span><span class="fl">4</span>,</span>
<span>            <span class="co"># Pathogen settings</span></span>
<span>            <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">h3</a></span><span class="op">(</span><span class="st">"Pathogen"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html" class="external-link">sliderInput</a></span><span class="op">(</span><span class="st">"R0"</span>, <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/HTML.html" class="external-link">HTML</a></span><span class="op">(</span><span class="st">"Basic reproduction number, &lt;i&gt;R&lt;/i&gt;&lt;sub&gt;0&lt;/sub&gt;"</span><span class="op">)</span>,</span>
<span>                value <span class="op">=</span> <span class="fl">1.3</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">5</span>, step <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html" class="external-link">sliderInput</a></span><span class="op">(</span><span class="st">"latent_pd"</span>, <span class="st">"Latent period (days)"</span>, value <span class="op">=</span> <span class="fl">2</span>, min <span class="op">=</span> <span class="fl">1</span>, max <span class="op">=</span> <span class="fl">7</span>, step <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html" class="external-link">sliderInput</a></span><span class="op">(</span><span class="st">"infec_pd"</span>, <span class="st">"Infectious period (days)"</span>, value <span class="op">=</span> <span class="fl">7</span>, min <span class="op">=</span> <span class="fl">1</span>, max <span class="op">=</span> <span class="fl">10</span>, step <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html" class="external-link">column</a></span><span class="op">(</span><span class="fl">4</span>,</span>
<span>            <span class="co"># Overlay controls: tokens that can be dragged onto the plot</span></span>
<span>            <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">h3</a></span><span class="op">(</span><span class="st">"Interventions"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="../reference/overlayToken.html">overlayToken</a></span><span class="op">(</span><span class="st">"vax"</span>, <span class="st">"Vaccination"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="../reference/overlayToken.html">overlayToken</a></span><span class="op">(</span><span class="st">"txi"</span>, <span class="st">"Transmission"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># --- App logic ---</span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>    <span class="co"># --- OVERLAY SETUP ---</span></span>
<span></span>
<span>    <span class="co"># Initialise 8 draggable/resizable overlays</span></span>
<span>    <span class="va">ov</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/overlayServer.html">overlayServer</a></span><span class="op">(</span><span class="st">"plot"</span>, <span class="fl">8</span>, width <span class="op">=</span> <span class="fl">56</span>, <span class="co"># 56 days = 8 weeks default width</span></span>
<span>        data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>vac_rate <span class="op">=</span> <span class="fl">10</span>, int_strength <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>, snap <span class="op">=</span> <span class="fu"><a href="../reference/snap_grid.html">snap_grid</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># --- OVERLAY DROPDOWN MENU ---</span></span>
<span></span>
<span>    <span class="co"># Render dropdown menu when an overlay is being edited</span></span>
<span>    <span class="va">output</span><span class="op">$</span><span class="va">plot_menu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderUI.html" class="external-link">renderUI</a></span><span class="op">(</span><span class="op">{</span></span>
<span>        <span class="va">i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/req.html" class="external-link">req</a></span><span class="op">(</span><span class="va">ov</span><span class="op">$</span><span class="va">editing</span><span class="op">)</span>  <span class="co"># Current overlay being edited</span></span>
<span>        <span class="va">fmt</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">t</span>, origin <span class="op">=</span> <span class="st">"1970-01-01"</span><span class="op">)</span>, <span class="st">"%b %d"</span><span class="op">)</span></span>
<span></span>
<span>        <span class="va">dropdown</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>            <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">div</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu">fmt</span><span class="op">(</span><span class="va">ov</span><span class="op">$</span><span class="va">cx0</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>, <span class="st">"–"</span>, <span class="fu">fmt</span><span class="op">(</span><span class="va">ov</span><span class="op">$</span><span class="va">cx1</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html" class="external-link">selectInput</a></span><span class="op">(</span><span class="st">"plot_label"</span>, <span class="cn">NULL</span>, choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Vaccination"</span>, <span class="st">"Transmission"</span><span class="op">)</span>, selected <span class="op">=</span> <span class="va">ov</span><span class="op">$</span><span class="va">label</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">ov</span><span class="op">$</span><span class="va">label</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Vaccination"</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">dropdown</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/numericInput.html" class="external-link">numericInput</a></span><span class="op">(</span><span class="st">"plot_vac_rate"</span>, <span class="st">"Vaccines per day (thousands)"</span>,</span>
<span>                value <span class="op">=</span> <span class="va">ov</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">vac_rate</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span>
<span>        <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">ov</span><span class="op">$</span><span class="va">label</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Transmission"</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">dropdown</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html" class="external-link">sliderInput</a></span><span class="op">(</span><span class="st">"plot_int_strength"</span>, <span class="st">"Transmission reduction (%)"</span>,</span>
<span>                value <span class="op">=</span> <span class="va">ov</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">int_strength</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span> <span class="op">(</span><span class="va">dropdown</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># --- EPIDEMIC MODEL RUNS BASED ON OVERLAY POSITIONS ---</span></span>
<span></span>
<span>    <span class="co"># Model run function</span></span>
<span>    <span class="va">run_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span>    <span class="op">{</span></span>
<span>        <span class="co"># Transform parameters</span></span>
<span>        <span class="va">I0</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">init_infec</span> <span class="op">/</span> <span class="fl">100</span>;</span>
<span>        <span class="va">duration</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">date_range</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">input</span><span class="op">$</span><span class="va">date_range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="va">infec_rate</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">input</span><span class="op">$</span><span class="va">latent_pd</span></span>
<span>        <span class="va">recov_rate</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">input</span><span class="op">$</span><span class="va">infec_pd</span></span>
<span>        <span class="va">trans_rate</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">R0</span> <span class="op">*</span> <span class="va">recov_rate</span></span>
<span></span>
<span>        <span class="co"># Build population</span></span>
<span>        <span class="va">pop</span> <span class="op">&lt;-</span> <span class="fu">population</span><span class="op">(</span></span>
<span>            name <span class="op">=</span> <span class="st">"Utopia"</span>,</span>
<span>            contact_matrix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>            demography_vector <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">pop_size</span> <span class="op">*</span> <span class="fl">1000000</span>,</span>
<span>            initial_conditions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">I0</span>, <span class="fl">0</span>, <span class="va">I0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span></span>
<span>        <span class="co"># Run model (with additional parameters from ...)</span></span>
<span>        <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">model_default</span><span class="op">(</span><span class="va">pop</span>, transmission_rate <span class="op">=</span> <span class="va">trans_rate</span>,</span>
<span>            infectiousness_rate <span class="op">=</span> <span class="va">infec_rate</span>, recovery_rate <span class="op">=</span> <span class="va">recov_rate</span>,</span>
<span>            time_end <span class="op">=</span> <span class="va">duration</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span>        <span class="co"># Transform results -- construct date and only return infection prevalence</span></span>
<span>        <span class="va">results</span><span class="op">$</span><span class="va">date</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">$</span><span class="va">time</span> <span class="op">+</span> <span class="va">input</span><span class="op">$</span><span class="va">date_range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>        <span class="va">results</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">[</span><span class="va">results</span><span class="op">$</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"infectious"</span>, <span class="op">]</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span> <span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="co"># Unmitigated epidemic</span></span>
<span>    <span class="va">epi_unmitigated</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html" class="external-link">reactive</a></span><span class="op">(</span><span class="op">{</span></span>
<span>        <span class="fu">run_model</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Mitigated epidemic</span></span>
<span>    <span class="va">epi_mitigated</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html" class="external-link">reactive</a></span><span class="op">(</span><span class="op">{</span></span>
<span>        <span class="co"># Create interventions</span></span>
<span>        <span class="va">tx_int</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="va">vax</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>        <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">ov</span><span class="op">$</span><span class="va">active</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">begin</span> <span class="op">&lt;-</span> <span class="va">ov</span><span class="op">$</span><span class="va">cx0</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">date_range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>            <span class="va">end</span> <span class="op">&lt;-</span> <span class="va">ov</span><span class="op">$</span><span class="va">cx1</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">date_range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="va">ov</span><span class="op">$</span><span class="va">label</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Vaccination"</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="va">nu</span> <span class="op">&lt;-</span> <span class="va">ov</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">vac_rate</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">*</span> <span class="fl">1000</span> <span class="op">/</span> <span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">pop_size</span> <span class="op">*</span> <span class="fl">1000000</span><span class="op">)</span></span>
<span>                <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">vax</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>                    <span class="va">vax</span> <span class="op">&lt;-</span> <span class="fu">vaccination</span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>, nu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">nu</span><span class="op">)</span>,</span>
<span>                        time_begin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">begin</span><span class="op">)</span>, time_end <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">end</span><span class="op">)</span><span class="op">)</span></span>
<span>                <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>                    <span class="va">ov</span><span class="op">$</span><span class="va">active</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span>                <span class="op">}</span></span>
<span>            <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">ov</span><span class="op">$</span><span class="va">label</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Transmission"</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="va">reduc</span> <span class="op">&lt;-</span> <span class="va">ov</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">int_strength</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">/</span> <span class="fl">100</span></span>
<span>                <span class="va">tx_int</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">tx_int</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">intervention</span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>,</span>
<span>                    type <span class="op">=</span> <span class="st">"rate"</span>, time_begin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">begin</span><span class="op">)</span>, time_end <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">end</span><span class="op">)</span>,</span>
<span>                    reduction <span class="op">=</span> <span class="va">reduc</span><span class="op">)</span></span>
<span>            <span class="op">}</span></span>
<span>        <span class="op">}</span></span>
<span></span>
<span>        <span class="co"># Get mitigated model results</span></span>
<span>        <span class="va">int</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">tx_int</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">int</span><span class="op">[[</span><span class="st">"transmission_rate"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">c</span>, <span class="va">tx_int</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="fu">run_model</span><span class="op">(</span>vaccination <span class="op">=</span> <span class="va">vax</span>,</span>
<span>            intervention <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">int</span><span class="op">)</span><span class="op">)</span> <span class="va">int</span> <span class="kw">else</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># --- RENDERING OF EPI CURVES ---</span></span>
<span></span>
<span>    <span class="co"># Render plot and align overlays to current axis limits</span></span>
<span>    <span class="va">output</span><span class="op">$</span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html" class="external-link">renderPlot</a></span><span class="op">(</span><span class="op">{</span></span>
<span>        <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">epi_unmitigated</span><span class="op">(</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">epi_mitigated</span><span class="op">(</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="st">"Infection prevalence (thousands)"</span><span class="op">)</span></span>
<span></span>
<span>        <span class="fu"><a href="../reference/overlayBounds.html">overlayBounds</a></span><span class="op">(</span><span class="va">ov</span>, <span class="va">plot</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">date_range</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># --- Run app ---</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></span></code></pre></div>
</details>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Nick Davies.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
