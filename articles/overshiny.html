<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Interactive overlays in Shiny • overshiny</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Interactive overlays in Shiny">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">overshiny</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/overshiny.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/epidemics.html">Tutorial: Overlays for interventions in epidemic modelling</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/nicholasdavies/overshiny/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Interactive overlays in Shiny</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nicholasdavies/overshiny/blob/master/vignettes/overshiny.Rmd" class="external-link"><code>vignettes/overshiny.Rmd</code></a></small>
      <div class="d-none name"><code>overshiny.Rmd</code></div>
    </div>

    
    
<p><code>overshiny</code> provides draggable and resizable rectangular
elements that overlay plots in Shiny apps. This may be useful in
applications where users need to define regions on the plot for further
input or processing.</p>
<p>Let’s take a look at a simple user interface that includes two
<code><a href="../reference/overlayToken.html">overlayToken()</a></code>s, which are small labels that can be dragged
onto the plot to create new overlays, and an
<code><a href="../reference/overlayPlotOutput.html">overlayPlotOutput()</a></code>, which is a plot where the overlays
will appear:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.posit.co/" class="external-link">shiny</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nicholasdavies/overshiny" class="external-link">overshiny</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># --- User interface ---</span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidPage</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/titlePanel.html" class="external-link">titlePanel</a></span><span class="op">(</span><span class="st">"Overlay demo"</span><span class="op">)</span>,</span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html" class="external-link">sidebarLayout</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html" class="external-link">sidebarPanel</a></span><span class="op">(</span></span>
<span>            <span class="co"># Control whether overlays are displayed and whether they alter the plot</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/checkboxInput.html" class="external-link">checkboxInput</a></span><span class="op">(</span><span class="st">"show_overlays"</span>, <span class="st">"Show overlays"</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/checkboxInput.html" class="external-link">checkboxInput</a></span><span class="op">(</span><span class="st">"enable_logic"</span>, <span class="st">"Enable overlay logic"</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            <span class="va">tags</span><span class="op">$</span><span class="fu">hr</span><span class="op">(</span><span class="op">)</span>,</span>
<span></span>
<span>            <span class="co"># Select date range for the plot</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/dateRangeInput.html" class="external-link">dateRangeInput</a></span><span class="op">(</span><span class="st">"date_range"</span>, <span class="st">"Date range"</span>, start <span class="op">=</span> <span class="st">"2025-01-01"</span>, end <span class="op">=</span> <span class="st">"2025-12-31"</span><span class="op">)</span>,</span>
<span>            <span class="va">tags</span><span class="op">$</span><span class="fu">hr</span><span class="op">(</span><span class="op">)</span>,</span>
<span></span>
<span>            <span class="co"># Overlay controls: tokens that can be dragged onto the plot</span></span>
<span>            <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">h5</a></span><span class="op">(</span><span class="st">"Drag tokens below onto the plot:"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="../reference/overlayToken.html">overlayToken</a></span><span class="op">(</span><span class="st">"grow"</span>, <span class="st">"Grow"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="../reference/overlayToken.html">overlayToken</a></span><span class="op">(</span><span class="st">"shrink"</span>, <span class="st">"Shrink"</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html" class="external-link">mainPanel</a></span><span class="op">(</span></span>
<span>            <span class="co"># Main plot with support for overlays</span></span>
<span>            <span class="fu"><a href="../reference/overlayPlotOutput.html">overlayPlotOutput</a></span><span class="op">(</span><span class="st">"plot"</span>, width <span class="op">=</span> <span class="st">"100%"</span>, height <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This sets up a sidebar layout, with controls on the left (including
the overlay tokens) and a display area on the right, which includes the
plot the overlays will be used with.</p>
<p>Now let’s put together our server function. We start by setting up
the overlays:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># --- App logic ---</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>{</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>    <span class="co"># --- OVERLAY SETUP ---</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>    <span class="co"># Initialise 8 draggable/resizable overlays</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>    ov <span class="ot">&lt;-</span> <span class="fu">overlayServer</span>(<span class="st">"plot"</span>, <span class="dv">8</span>, <span class="at">width =</span> <span class="dv">56</span>, <span class="co"># 56 days = 8 weeks default width</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>        <span class="at">data =</span> <span class="fu">list</span>(<span class="at">strength =</span> <span class="dv">50</span>), <span class="at">snap =</span> <span class="fu">snapGrid</span>())</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>    <span class="co"># Toggle overlay visibility based on checkbox</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>    <span class="fu">observe</span>({</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>        ov<span class="sc">$</span>show <span class="ot">&lt;-</span> <span class="fu">isTRUE</span>(input<span class="sc">$</span>show_overlays)</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>    })</span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>    </span></code></pre></div>
<p>The call to <code><a href="../reference/overlayServer.html">overlayServer()</a></code> initializes (up to) 8
overlays that we can use. It also sets the default width of new overlays
to 56, which is in plot coordinates. We’ll be plotting a time series, so
this means 56 days (8 weeks). It provides the argument
<code>data</code>, which is a list of additional attributes to be
associated with each overlay. Here we’re specifying that each overlay
will have an associated <code>strength</code> attribute, which we’ll use
to determine how much each overlay affects the output. And finally, we
use <code>snap = snapGrid()</code> to specify a snapping function; the
default parameters for <code><a href="../reference/snapGrid.html">snapGrid()</a></code> ensure that each
overlay’s position and width is snapped to the nearest whole number.</p>
<p>Then, we start with some of the reactive logic of the overlays. We
have a checkbox in our UI to control whether the overlays are shown or
not, and the call to <code><a href="https://rdrr.io/pkg/shiny/man/observe.html" class="external-link">observe()</a></code> makes the overlays show or
hide based on the value of this checkbox.</p>
<p>Continuing on:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>    <span class="co"># --- OVERLAY DROPDOWN MENU ---</span></span>
<span></span>
<span>    <span class="co"># Render dropdown menu when an overlay is being edited</span></span>
<span>    <span class="va">output</span><span class="op">$</span><span class="va">plot_menu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderUI.html" class="external-link">renderUI</a></span><span class="op">(</span><span class="op">{</span></span>
<span>        <span class="va">i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/req.html" class="external-link">req</a></span><span class="op">(</span><span class="va">ov</span><span class="op">$</span><span class="va">editing</span><span class="op">)</span>  <span class="co"># Current overlay being edited</span></span>
<span>        <span class="va">fmt</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">t</span>, origin <span class="op">=</span> <span class="st">"1970-01-01"</span><span class="op">)</span>, <span class="st">"%b %d"</span><span class="op">)</span></span>
<span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>            <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">div</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu">fmt</span><span class="op">(</span><span class="va">ov</span><span class="op">$</span><span class="va">cx0</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>, <span class="st">"–"</span>, <span class="fu">fmt</span><span class="op">(</span><span class="va">ov</span><span class="op">$</span><span class="va">cx1</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html" class="external-link">selectInput</a></span><span class="op">(</span><span class="st">"plot_label"</span>, <span class="cn">NULL</span>, choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Grow"</span>, <span class="st">"Shrink"</span><span class="op">)</span>, selected <span class="op">=</span> <span class="va">ov</span><span class="op">$</span><span class="va">label</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html" class="external-link">sliderInput</a></span><span class="op">(</span><span class="st">"plot_strength"</span>, <span class="st">"Strength"</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">100</span>, value <span class="op">=</span> <span class="va">ov</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">strength</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/dateInput.html" class="external-link">dateInput</a></span><span class="op">(</span><span class="st">"plot_cx"</span>, <span class="st">"Start date"</span>, value <span class="op">=</span> <span class="va">ov</span><span class="op">$</span><span class="va">cx0</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html" class="external-link">sliderInput</a></span><span class="op">(</span><span class="st">"plot_cw"</span>, <span class="st">"Duration"</span>, min <span class="op">=</span> <span class="fl">1</span>, max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">ov</span><span class="op">$</span><span class="va">bound_cw</span><span class="op">)</span>, value <span class="op">=</span> <span class="va">ov</span><span class="op">$</span><span class="va">cx1</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">-</span> <span class="va">ov</span><span class="op">$</span><span class="va">cx0</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Each overlay automatically has a dropdown menu for adjusting settings
for the overlay. By default, this only includes a “remove” button that
can be used to remove the overlay. But we can add extra elements to
these menus by using <code><a href="https://rdrr.io/pkg/shiny/man/renderUI.html" class="external-link">renderUI()</a></code>.</p>
<p>Since we created an <code><a href="../reference/overlayPlotOutput.html">overlayPlotOutput()</a></code> with the output
ID <code>"plot"</code>, <code>overshiny</code> has also created a UI
output slot named <code>"plot_menu"</code> which is used to add extra
elements to each overlay’s dropdown menu. For our purposes, we’ll
include a <code><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">div()</a></code> element which shows the date range for the
overlay, a <code><a href="https://rdrr.io/pkg/shiny/man/selectInput.html" class="external-link">selectInput()</a></code> to choose between “Grow” and
“Shrink” type overlays, and a <code><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html" class="external-link">sliderInput()</a></code> to choose the
percentage “strength” associated with the overlay. We also allow the
user to manually enter the start date of each overlay
(<code>"plot_cx"</code>) and the width of each overlay
(<code>"plot_cw"</code>). Here, <code>"plot_label"</code>,
<code>"plot_cx"</code>, and <code>"plot_cw"</code> will automatically
set the label, position, and width of each overlay because
<code>"label"</code>, <code>"cx"</code>, and <code>"cw"</code> are
interpreted specially by <code>overshiny</code>. <code>"strength"</code>
doesn’t have any special interpretation so it will be applied to
<code>ov$data$strength</code>. See the documentation for
<code><a href="../reference/overlayServer.html">overlayServer()</a></code> for more details.</p>
<p>The line <code>i &lt;- req(ov$editing)</code> just gets the index (1
to 8) of the current overlay being edited. The call to
<code><a href="https://rdrr.io/pkg/shiny/man/req.html" class="external-link">req()</a></code> ensures that the rest of the code in the
<code><a href="https://rdrr.io/pkg/shiny/man/renderUI.html" class="external-link">renderUI()</a></code> call won’t be run unless there is an overlay
currently being edited via its dropdown menu.</p>
<p>Note that above, each overlay has the same elements in its dropdown
menu, but we could choose to return different contents for the dropdown
menu depending on which overlay is being edited.</p>
<p>Now let’s make some data to plot based on the overlays and their
properties:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>    <span class="co"># --- DATA PROCESSING BASED ON OVERLAY POSITION ---</span></span>
<span></span>
<span>    <span class="co"># Reactive dataset: oscillating signal modified by active overlays</span></span>
<span>    <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html" class="external-link">reactive</a></span><span class="op">(</span><span class="op">{</span></span>
<span>        <span class="va">date_seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">date_range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">input</span><span class="op">$</span><span class="va">date_range</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, by <span class="op">=</span> <span class="st">"1 day"</span><span class="op">)</span></span>
<span>        <span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">date_seq</span><span class="op">)</span> <span class="op">/</span> <span class="fl">58</span><span class="op">)</span>  <span class="co"># oscillating signal</span></span>
<span></span>
<span>        <span class="co"># Modify signal according to active overlays if logic is enabled</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Logic.html" class="external-link">isTRUE</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">enable_logic</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">ov</span><span class="op">$</span><span class="va">active</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="va">start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">ov</span><span class="op">$</span><span class="va">cx0</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, origin <span class="op">=</span> <span class="st">"1970-01-01"</span><span class="op">)</span></span>
<span>                <span class="va">end</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">ov</span><span class="op">$</span><span class="va">cx1</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, origin <span class="op">=</span> <span class="st">"1970-01-01"</span><span class="op">)</span></span>
<span>                <span class="va">in_range</span> <span class="op">&lt;-</span> <span class="va">date_seq</span> <span class="op">&gt;=</span> <span class="va">start</span> <span class="op">&amp;</span> <span class="va">date_seq</span> <span class="op">&lt;=</span> <span class="va">end</span></span>
<span>                <span class="va">factor</span> <span class="op">&lt;-</span> <span class="va">ov</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">strength</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">/</span> <span class="fl">100</span></span>
<span>                <span class="va">y</span><span class="op">[</span><span class="va">in_range</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span><span class="va">in_range</span><span class="op">]</span> <span class="op">*</span> <span class="kw">if</span> <span class="op">(</span><span class="va">ov</span><span class="op">$</span><span class="va">label</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Grow"</span><span class="op">)</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">factor</span><span class="op">)</span> <span class="kw">else</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">factor</span><span class="op">)</span></span>
<span>            <span class="op">}</span></span>
<span>        <span class="op">}</span></span>
<span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>date <span class="op">=</span> <span class="va">date_seq</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Above, we create a <code><a href="https://rdrr.io/pkg/shiny/man/reactive.html" class="external-link">reactive()</a></code> data.frame. We set up a
sinusoidally-varying time series, then (if the “Enable overlay logic”
checkbox is checked) we either “grow” or “shrink” this time series where
it overlaps with each active overlay. We’re using the <code>ov</code>
object returned by <code><a href="../reference/overlayServer.html">overlayServer()</a></code> to do this.</p>
<p>Finally, we render the time series:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>    <span class="co"># --- RENDERING OF DATA ---</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>    <span class="co"># Render plot and align overlays to current axis limits</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>    output<span class="sc">$</span>plot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>        plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data</span>()) <span class="sc">+</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>            <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>            <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>            <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Signal"</span>)</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>        <span class="fu">overlayBounds</span>(ov, plot, <span class="at">xlim =</span> <span class="fu">c</span>(input<span class="sc">$</span>date_range), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>))</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>    })</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>This just creates a <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot()</a></code> plot of the time series,
and includes a call to <code><a href="../reference/overlayBounds.html">overlayBounds()</a></code> at the end of the
<code><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html" class="external-link">renderPlot()</a></code> expression block to ensure the overlays are
aligned properly. <code><a href="../reference/overlayBounds.html">overlayBounds()</a></code> itself returns the plot
so this also returns our plot object to Shiny to be plotted.</p>
<p>Now all that’s left is to run the app:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># --- Run app ---</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Nick Davies.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
